<?php


////////////////////////////////////////////////////////////////////////////////
// GENERIC PUDL EXCEPTION - ALL OTHER EXCEPTIONS INHERIT THIS CLASS
////////////////////////////////////////////////////////////////////////////////
class pudlException extends Exception {
	public function __construct($pudl, $message=null, $code=0, $previous=null) {
		parent::__construct($message, $code, $previous);
		$this->pudl = $pudl;

		if (!($pudl instanceof pudl)) return;

		// STORE THE LAST QUERY BEFORE WE EXECUTE A NEW ONE
		$query = $pudl->query();

		// PREVENT INFINITE RECURSIONS
		if (self::$recurse) return;
		self::$recurse = true;

		// RESET INTERNAL PUDL STATE
		try { $pudl->decache();		} catch (Exception $e) {}
		try { $pudl->destring();	} catch (Exception $e) {}
		try { $pudl->decursion();	} catch (Exception $e) {}
		try { $pudl->rollback();	} catch (Exception $e) {}

		// RUN A GENERIC QUERY TO RESET EXTERNAL ERROR CODES
		try { $pudl('SELECT 1');	} catch (Exception $e) {}

		// RESET THE INTERNAL QUERY STRING FOR DEBUGGING
		try { $pudl->string();		} catch (Exception $e) {}
		try { $pudl($query);		} catch (Exception $e) {}
		try { $pudl->destring();	} catch (Exception $e) {}

		self::$recurse = false;
	}

	public			$pudl		= NULL;
	private	static	$recurse	= false;
}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN A CONNECTION ERROR OCCURS
////////////////////////////////////////////////////////////////////////////////
class pudlConnectionException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN A DATA TYPE IS INVALID FOR THE GIVEN CALL
////////////////////////////////////////////////////////////////////////////////
class pudlTypeException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WITH THE DATA VALUE IS INVALID FOR THE GIVEN CALL
////////////////////////////////////////////////////////////////////////////////
class pudlValueException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN THE GIVEN FUNCTION CALL IS INVALID
////////////////////////////////////////////////////////////////////////////////
class pudlFunctionException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN THE GIVEN CLASS METHOD CALL IS INVALID
////////////////////////////////////////////////////////////////////////////////
class pudlMethodException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN A REQUIRED PHP EXTENSION IS NOT INSTALLED/ENABLED
////////////////////////////////////////////////////////////////////////////////
class pudlExtensionException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN A RECURSION LIMIT IS REACHED
////////////////////////////////////////////////////////////////////////////////
class pudlRecursionException extends pudlException {}




////////////////////////////////////////////////////////////////////////////////
// THROWN WHEN AN ISSUE WITH THE FILE SYSTEM HAS HAPPENED
////////////////////////////////////////////////////////////////////////////////
class pudlFileException extends pudlException {}
